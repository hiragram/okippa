# SQLite セットアップガイド

このプロジェクトではSQLiteをバックエンドデータベースとして使用しています。以下にセットアップ方法と使用方法について説明します。

## セットアップ内容

プロジェクトには以下のコンポーネントが追加されています：

1. **データベース接続モジュール** (`lib/db.ts`)
   - SQLiteデータベースへの接続管理
   - 接続取得と終了処理の関数を提供

2. **データベーススキーマ設定** (`lib/dbSetup.ts`)
   - テーブル作成やスキーマ更新を管理
   - 開発環境用のシードデータを提供

3. **初期化スクリプト** (`scripts/initDb.ts`)
   - データベースの初期セットアップを実行

4. **サンプルAPI** (`app/api/users/route.ts`)
   - ユーザー情報のCRUD操作のサンプル実装

## セットアップと初期化

### 自動セットアップ（推奨）

プロジェクトの初期セットアップには以下のコマンドを使用できます：

```bash
npm run setup
```

セットアップスクリプトは以下の処理を自動的に行います：
- 必要なディレクトリの作成
- 依存パッケージのインストール
- データベースの初期化

### 手動初期化

個別にデータベースの初期化だけを行う場合は以下のコマンドを実行します：

```bash
npm run db:init
```

このコマンドは次の処理を行います：
- SQLiteデータベースファイル (`db/okippa.db`) の作成
- 必要なテーブルの作成
- 開発環境の場合はサンプルデータの挿入

## 使用方法

### API経由でのアクセス

サンプルとして、ユーザー情報を扱うAPIが実装されています：

- `GET /api/users` - 全ユーザー情報の取得
- `POST /api/users` - 新規ユーザーの作成

### コードでの直接アクセス

他のコンポーネントからデータベースにアクセスするには、以下のように `getDb()` 関数を使用します：

```typescript
import { getDb } from '../lib/db';

// データベースインスタンスの取得
const db = getDb();

// クエリの実行
const users = db.prepare('SELECT * FROM users').all();
```

## 注意事項

- APIエンドポイントなど、データベースにアクセスするコードでは例外処理を適切に行ってください
- パスワードなどの機密情報は実際の環境では適切にハッシュ化してください
- データベースファイル (`db/*.db`) は `.gitignore` に追加されているため、Git管理対象外となっています
